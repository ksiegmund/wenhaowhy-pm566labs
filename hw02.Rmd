---
title: "HW02"
author: "Wy"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(dtplyr)
library(lubridate)
library(tidyverse)
library(data.table)
library(knitr)
library(ggplot2)
library(leaflet)

```

```{r}
library(data.table)
chsi <- read.csv( "https://raw.githubusercontent.com/USCbiostats/data-science-data/master/01_chs/chs_individual.csv")

chsr <- read.csv("https://raw.githubusercontent.com/USCbiostats/data-science-data/master/01_chs/chs_regional.csv")
```

```{r}
summary(chsi)

head(chsi)
head(chsr)
```
```{r}
#merging datasets by location
chsc <- merge(chsi, chsr, by = "townname")
#chsc <- data.table(chsc) wasn't working

nrow(chsc)
nrow(chsi)
nrow(chsr)
```


```{r}
#creating new categorical variable 

chsc$obesity_level <- as.factor(ifelse(chsc$bmi < 14, 'underweight',
                     ifelse(chsc$bmi < 22, 'normal', 
                     ifelse(chsc$bmi < 24, 'overweight', 'obese'))))

```


```{r}
#create a summary table that contains the minimum BMI, maximum BMI, and the total number of observations per category.
sum1 <- chsc %>%
  select(obesity_level, bmi)

summary(sum1)

```


```{r}

#Create another categorical variable named “smoke_gas_exposure” that summarizes “Second Hand Smoke” and “Gas Stove.” The variable should have four categories in total.
chsc <- mutate(chsc, smoke_gas_exposure =
  ifelse(smoke == 1 & gasstove == 1, "both", 
   ifelse(smoke == 1 & gasstove ==0, "just_smoke", 
    ifelse(smoke ==0 & gasstove == 1, "just_gas",
      "none"))))

table(chsc$smoke_gas_exposure)

#Error in ifelse(smoke == 1 & gasstove == 1, "both", ifelse(smoke == 1 & : object 'smoke' not found

```


```{r}
#Create four summary tables showing the average (or proportion, if binary) and sd of “Forced expiratory volume in 1 second (ml)” and asthma indicator by town, sex, obesity level, and “smoke_gas_exposure.”
#4 
#mean and stdev of fev by town
chsc_town <- group_by(chsc, townname)

summarize(chsc_town, mean(fev, na.rm = TRUE),
          sd(fev, na.rm=TRUE) )

```


```{r}
#mean and stdev of fev by sex
chsc <- mutate(chsc, sex = ifelse(male == 1,  "male", "female"))

chsc_sex <- group_by(chsc, sex)

summarize(chsc_sex, mean(fev, na.rm = TRUE),
          sd(fev, na.rm=TRUE) )
```
```{r}
#mean and stdev of fev by obesity level

chsc_obesity_level <- group_by(chsc, obesity_level)

summarize(chsc_obesity_level, mean(fev, na.rm = TRUE),
          sd(fev, na.rm=TRUE) )
```

```{r}
#mean and stdev of fev by smoke exposure

chsc_smoke_gas_exposure <- group_by(chsc, smoke_gas_exposure)

summarize(chsc_smoke_gas_exposure, mean(fev, na.rm = TRUE),
          sd(fev, na.rm=TRUE) )
```



PART 2 EDA

```{r}
#1 Facet plot showing scatterplots with regression lines of BMI vs FEV by “townname”.

chsc %>%
  ggplot(aes(x=bmi,y=fev)) +
  geom_point(aes(color=townname)) +
  labs(x= "Body Mass Index", y="FEV")
  geom_point() + geom_smooth(method = "lm", se = FALSE)
```

```{r}
#Stacked histograms of FEV by BMI category and FEV by smoke/gas exposure. Use different color schemes than the ggplot default.

ggplot(data=chsc, aes(x=fev, fill = smoke_gas_exposure)) + geom_histogram()+ scale_fill_brewer()  #using a predefined palette

ggplot(data=chsc, aes(x=fev, fill = obesity_level)) + geom_histogram()+ scale_fill_brewer()  #using a predefined palette
```

```{r}
#3 Barchart of BMI by smoke/gas exposure

ggplot(data=chsc, aes(x= smoke_gas_exposure, y=bmi)) +
  stat_summary(fun.bmi=mean, geom= "bar")

#average BMI appears consistently under 20 for the 5 groups of smoke vs gas exposure.  BMI appears lowest in the group that was subject to neither smoke or gas.
```


```{r}
#4 Statiscal summary graph of bmi with fev
 chsc[!is.na(fev)] %>%
  ggplot(mapping = aes(x = chsc_obesity_level, y = fev)) + 
    stat_summary(fun.data = mean_sdl, geom = "pointrange") +
    stat_summary(fun.data = mean_sdl, geom = "errorbar") 

#4 Statiscal summary graph of smoke gas exposure with fev
chsc[!is.na(fev)] %>%
  ggplot(mapping = aes(x = smoke_gas_exposure, y = fev)) + 
    stat_summary(fun.data = mean_sdl, geom = "pointrange") +
    stat_summary(fun.data = mean_sdl, geom = "errorbar") 
#function would not run for some reason : object 'fev' not found
  
```



ggplot(data=chsc, aes(x= smoke_gas_exposure, y=bmi, by=smoke_gas_exposure)) +
  geom_bar(stat = "identity")AA
```{r}

#5 A leaflet map showing the concentrations of PM2.5 mass in each of the CHS communities.
pm.pal <- colorNumeric(c('darkgreen','goldenrod'), domain=chsc$pm25_mass)
pm.pal
  
leaflet(chsc) %>% 
  addProviderTiles('CartoDB.Positron') %>% 
  addCircles(
    lat = ~lat, lng=~lon,
    opacity = 1, fillOpacity = 1, radius = 500, color = ~pm.pal(pm25_mass)
    )
```
























```{r}

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
